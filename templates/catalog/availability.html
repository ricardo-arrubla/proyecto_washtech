{% extends "base.html" %}

{% block title %}Consultar Disponibilidad - WashTech{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold mb-3">
            <i class="fas fa-calendar-check text-primary me-3"></i>
            Consultar Disponibilidad
        </h1>
        <p class="lead text-muted">Verifica qué lavadoras están disponibles en la fecha que necesitas</p>
    </div>

    <!-- Formulario de Búsqueda -->
    <div class="row justify-content-center mb-5">
        <div class="col-md-6">
            <div class="card border-0 shadow">
                <div class="card-body p-4">
                    <form method="GET" action="{{ url_for('catalog.check_availability') }}">
                        <div class="mb-3">
                            <label for="date" class="form-label">
                                <i class="fas fa-calendar me-2"></i>Selecciona una fecha
                            </label>
                            <input type="date" class="form-control form-control-lg" id="date" name="date" 
                                   value="{{ date }}" min="{{ today }}" required>
                            <small class="text-muted">Selecciona la fecha en que necesitas la lavadora</small>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-search me-2"></i>Buscar Disponibilidad
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Resultados -->
    {% if date %}
    <div class="row">
        <div class="col-12 mb-4">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Resultados para:</strong> {{ date }}
                {% if machines %}
                    - Se encontraron <strong>{{ machines|length }}</strong> lavadora(s) disponible(s)
                {% endif %}
            </div>
        </div>

        {% if machines %}
            {% for machine in machines %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="position-relative">
                        {% if machine.image_url %}
                            <img src="{{ machine.image_url }}" class="card-img-top" alt="{{ machine.model }}" 
                                 style="height: 200px; object-fit: cover;">
                        {% else %}
                            <div class="bg-light d-flex align-items-center justify-content-center" 
                                 style="height: 200px;">
                                <i class="fas fa-washing-machine fa-4x text-secondary"></i>
                            </div>
                        {% endif %}
                        <span class="position-absolute top-0 end-0 m-3 badge bg-success">
                            <i class="fas fa-check-circle me-1"></i>Disponible
                        </span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ machine.model }}</h5>
                        <p class="text-muted mb-2">
                            <i class="fas fa-weight-hanging me-2"></i>
                            <strong>Capacidad:</strong> {{ machine.capacity }}
                        </p>
                        <p class="text-muted mb-3">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            {% if machine.inventory %}{{ machine.inventory.location }}{% else %}Sin ubicación{% endif %}
                        </p>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('catalog.detail', id=machine.id) }}" 
                               class="btn btn-outline-primary">
                                <i class="fas fa-eye me-2"></i>Ver Detalles
                            </a>
                            {% if current_user.is_authenticated %}
                            <a href="{{ url_for('reservation.create', machine_id=machine.id, date=date) }}" 
                               class="btn btn-success">
                                <i class="fas fa-calendar-plus me-2"></i>Reservar
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <div class="text-center py-5">
                    <i class="fas fa-calendar-times fa-5x text-muted mb-4"></i>
                    <h3 class="text-muted">No hay lavadoras disponibles</h3>
                    <p class="text-muted mb-4">
                        No se encontraron lavadoras disponibles para la fecha {{ date }}
                    </p>
                    <a href="{{ url_for('catalog.check_availability') }}" class="btn btn-primary">
                        <i class="fas fa-redo me-2"></i>Buscar Otra Fecha
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
    {% else %}
    <!-- Estado Inicial -->
    <div class="row">
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-calendar-alt fa-5x text-muted mb-4"></i>
                <h3 class="text-muted">Selecciona una fecha</h3>
                <p class="text-muted">Ingresa la fecha para ver las lavadoras disponibles</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Información Adicional -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0 bg-light">
                <div class="card-body p-4">
                    <h5 class="mb-3">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>
                        Consejos para tu Reserva
                    </h5>
                    <ul class="mb-0">
                        <li class="mb-2">Reserva con anticipación para asegurar la disponibilidad</li>
                        <li class="mb-2">Verifica el horario de entrega en tu zona</li>
                        <li class="mb-2">Ten lista tu dirección completa para la entrega</li>
                        <li class="mb-2">Contacta con nosotros si tienes dudas sobre el proceso</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Establecer fecha mínima como hoy
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').min = today;
    
    // Si no hay fecha seleccionada, poner la de hoy
    if (!document.getElementById('date').value) {
        document.getElementById('date').value = today;
    }
</script>
{% endblock %}