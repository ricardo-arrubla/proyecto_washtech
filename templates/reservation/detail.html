{% extends "base.html" %}

{% block title %}Detalle de Reserva - WashTech{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Header -->
            <div class="d-flex align-items-center mb-4">
                <a href="{{ url_for('reservation.index') }}" class="btn btn-outline-secondary me-3">
                    <i class="fas fa-arrow-left me-2"></i>Volver
                </a>
                <div>
                    <h2 class="mb-0">
                        <i class="fas fa-receipt me-2"></i>Detalle de Reserva #{{ reservation.id }}
                    </h2>
                    <p class="text-muted mb-0">Información completa de tu reserva</p>
                </div>
            </div>

            <!-- Status Badge -->
            <div class="mb-4">
                {% if reservation.status == 'pendiente' %}
                    <span class="badge bg-warning text-dark fs-6">
                        <i class="fas fa-hourglass-half me-2"></i>Pendiente
                    </span>
                {% elif reservation.status == 'confirmada' %}
                    <span class="badge bg-success fs-6">
                        <i class="fas fa-check-circle me-2"></i>Confirmada
                    </span>
                {% elif reservation.status == 'cancelada' %}
                    <span class="badge bg-danger fs-6">
                        <i class="fas fa-times-circle me-2"></i>Cancelada
                    </span>
                {% elif reservation.status == 'completada' %}
                    <span class="badge bg-info fs-6">
                        <i class="fas fa-flag-checkered me-2"></i>Completada
                    </span>
                {% elif reservation.status == 'entregado' %}
                    <span class="badge bg-success fs-6">
                        <i class="fas fa-check me-2"></i>Entregado
                    </span>
                {% endif %}
            </div>

            <!-- Main Card -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light border-bottom">
                    <h5 class="mb-0">
                        <i class="fas fa-washing-machine me-2 text-primary"></i>Información de la Lavadora
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Modelo</label>
                                <p class="h5 mb-0">{{ reservation.washing_machine.model }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">Capacidad</label>
                                <p class="h6 mb-0">{{ reservation.washing_machine.capacity }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Estado Operativo</label>
                                <p class="h6 mb-0">
                                    {% if reservation.washing_machine.operational_status == 'operativa' %}
                                        <span class="badge bg-success">Operativa</span>
                                    {% elif reservation.washing_machine.operational_status == 'mantenimiento' %}
                                        <span class="badge bg-warning">Mantenimiento</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactiva</span>
                                    {% endif %}
                                </p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">Imagen</label>
                                <div>
                                    <img src="{{ reservation.washing_machine.image_url or '/static/images/icono de lavadora.jpg' }}" 
                                         alt="{{ reservation.washing_machine.model }}" 
                                         style="max-width: 150px; height: auto; border-radius: 6px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reservation Details Card -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light border-bottom">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2 text-primary"></i>Detalles de la Reserva
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Fecha de Reserva</label>
                                <p class="h6 mb-0">{{ reservation.reservation_date.strftime('%d/%m/%Y') }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">Hora de Inicio</label>
                                <p class="h6 mb-0">{{ reservation.start_time.strftime('%H:%M') }} hrs</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Hora de Finalización</label>
                                <p class="h6 mb-0">{{ reservation.end_time.strftime('%H:%M') }} hrs</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">Creada el</label>
                                <p class="h6 mb-0">{{ reservation.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Card -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light border-bottom">
                    <h5 class="mb-0">
                        <i class="fas fa-money-bill-wave me-2 text-primary"></i>Información de Pago
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Monto Total</label>
                                <p class="h4 mb-0 text-success fw-bold">${{ "%.2f"|format(reservation.total_payment) }} COP</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Estado del Pago</label>
                                <p class="h6 mb-0">
                                    {% if reservation.payments %}
                                        <span class="badge bg-success">Pagado</span>
                                    {% else %}
                                        <span class="badge bg-warning text-dark">Pendiente de Pago</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Operator Assignment Card (if assigned) -->
            {% if reservation.assigned_operator %}
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light border-bottom">
                    <h5 class="mb-0">
                        <i class="fas fa-user-tie me-2 text-primary"></i>Operador Asignado
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Nombre</label>
                                <p class="h6 mb-0">{{ reservation.assigned_operator.name }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">Email</label>
                                <p class="h6 mb-0">{{ reservation.assigned_operator.email }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- User Info Card -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light border-bottom">
                    <h5 class="mb-0">
                        <i class="fas fa-user-circle me-2 text-primary"></i>Información del Cliente
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Nombre</label>
                                <p class="h6 mb-0">{{ reservation.user.name }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">Email</label>
                                <p class="h6 mb-0">{{ reservation.user.email }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Teléfono</label>
                                <p class="h6 mb-0">{{ reservation.user.phone or 'No registrado' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="d-flex gap-2 justify-content-between">
                <a href="{{ url_for('reservation.index') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-list me-2"></i>Volver a Mis Reservas
                </a>
                {% if reservation.status == 'pendiente' and current_user.role == 'cliente' %}
                <form method="POST" action="{{ url_for('reservation.cancel', id=reservation.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('¿Estás seguro de que deseas cancelar esta reserva?')">
                        <i class="fas fa-times-circle me-2"></i>Cancelar Reserva
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}
